# File generated by Wizard 2.2205.6 on Oct 20, 2025.


behavior head_to_CRL
precondition 
    //PLATFORM.AuxDataBool("AT_CRL");
   return true;
end_precondition

execute 
   PLATFORM.SetHeading(90);
   
   if (PLATFORM.SlantRangeTo(WsfSimulation.FindPlatform("global_ibcs_battalion_eoc")) < 60000)
      PLATFORM.SetAuxData("AT_CRL", 1);
   
end_execute
end_behavior 

#TO DO: Need routes for getting to CAP, CAP, retreat. Can be used in behaviors

# Behavior to move aircraft to CAP location and follow a CAP route
## Input Aux Data
# ADJUST_CAP - bool, if true will try to change cap location based on input
# CAP_HEADING - heading of CAP route as a string
# CAP_LOCATION - location of CAP as a string
behavior cap
   script_variables 
#      WsfGeoPoint capLocation = WsfGeoPoint();
#      string routeName = "capRoute";
#      double minRadiustoStartCap = 1000;
#      double capAltitude = 30000 * MATH.M_PER_FT();
#      double startTime = 0;
#      double waitTime = 5 * 60;
#      double capSpeed = 488 * MATH.MPS_PER_NMPH();
#      double capHeading = 0;
#      bool changeCapLocation = false;
      bool facingForward;
      bool startedCap = false;
   end_script_variables
   
   precondition
      if (TIME_NOW > 120)
      {
         return true;
      }
      else
         return false;
   end_precondition
   
   execute
#      if(isFlightLeader(PLATFORM))
#      {
#         if(PLATFORM.Route().Name() == routeName && !changeCapLocation)
#         {
#            PLATFORM.FollowRoute(PLATFORM.Route(), PLATFORM.RoutePointIndex());    
#            PLATFORM.SetAuxData("MSP_FORMATION_FLY", false);
#            if(PLATFORM.AuxDataExists("FORMATION_DATA"))
#            {
#               Map<string, int> formationData = (Map<string, int>)PLATFORM.AuxDataObject("FORMATION_DATA");
#               startTime = TIME_NOW;
#               foreach(string str:int val in formationData)
#               {
#                  if(str != PLATFORM.Name())
#                  {      
#                     WsfPlatform plat = WsfSimulation.FindPlatform(str);
#                     if(plat.IsValid())
#                     {
#                        plat.FollowRoute(plat.Route(), plat.RoutePointIndex());
#                        plat.SetAuxData("MSP_FORMATION_FLY", false);
#                     }
#                  }
#               }
#            }
#         }
#         else if(PLATFORM.SlantRangeTo(capLocation) <= minRadiustoStartCap)
#         {
#            WsfRoute rte = WsfRoute.CopyGlobal(routeName);
#            rte.Transform(PLATFORM.Latitude(), PLATFORM.Longitude(), capHeading);
#            rte = addRouteSpeed(rte, capSpeed);
#            rte = addRouteAltitude(rte, capAltitude);
#            PLATFORM.FollowRoute(rte);
#            PLATFORM.SetAuxData("ADJUST_CAP", false);
#            if(PLATFORM.AuxDataExists("FORMATION_DATA"))
#            {
#               Map<string, int> formationData = (Map<string, int>)PLATFORM.AuxDataObject("FORMATION_DATA");
#               startTime = TIME_NOW;
#               foreach(string str:int val in formationData)
#               {
#                  if(str != PLATFORM.Name())
#                  {
#                     WsfPlatform plat = WsfSimulation.FindPlatform(str);
#                     if(plat.IsValid())
#                     {
#                        WsfRoute rtePlat = WsfRoute.CopyGlobal(routeName);
#                        rtePlat.Transform(plat.Latitude(), plat.Longitude(), capHeading);
#                        rtePlat = addRouteSpeed(rtePlat, capSpeed);
#                        rtePlat = addRouteAltitude(rtePlat, capAltitude);
#                        plat.FollowRoute(rtePlat);
#                        plat.SetAuxData("MSP_FORMATION_FLY", false);
#                        plat.SetAuxData("ADJUST_CAP", false);
#                     }
#                  }
#               }
#            }
#         }
#         else
#         {
#            PLATFORM.GoToLocation(capLocation);
#            if(PLATFORM.AuxDataExists("FORMATION_DATA"))
#            {
#               Map<string, int> formationData = (Map<string, int>)PLATFORM.AuxDataObject("FORMATION_DATA");
#               foreach(string str:int val in formationData)
#               {
#                  if(str != PLATFORM.Name())
#                  {
#                     WsfPlatform plat = WsfSimulation.FindPlatform(str);
#                     if(plat.IsValid())
#                     {
#                        plat.SetAuxData("MSP_FORMATION_FLY", true);
#                     }
#                  }
#               }
#            }
#         }
#      }
      if (!startedCap) {
         startedCap = true;
         if (PLATFORM.AuxDataBool("left_side")) {
            facingForward = true;
         } else {
            facingForward = false;
         }
      }

      if (PLATFORM.CheckAuxData("is_in_custom_route")) {
         if (PLATFORM.AuxDataBool("is_in_custom_route") == false) {
            PLATFORM.SetAuxData("is_in_custom_route", true);
            if (PLATFORM.AuxDataBool("left_side")) {
               if (facingForward) {
                  WsfRoute route = WsfRoute.FindGlobal("turn_south_left");
                  facingForward = false;
                  PLATFORM.FollowRoute(route);
               } else {
                  WsfRoute route = WsfRoute.FindGlobal("turn_north_left");
                  facingForward = true;
                  PLATFORM.FollowRoute(route);
               }
            } else {
               if (facingForward) {
                  WsfRoute route = WsfRoute.FindGlobal("turn_south_right");
                  facingForward = false;
                  PLATFORM.FollowRoute(route);
               } else {
                  WsfRoute route = WsfRoute.FindGlobal("turn_north_right");
                  facingForward = true;
                  PLATFORM.FollowRoute(route);
               }
            }
         }
      }
      PLATFORM.SetAuxData("cap", true);
      
   end_execute
end_behavior

route capRoute
   label start offset 0 0 nm
   offset 5 0 nm
      goto start
end_route

route cap_right
   label start offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
   turn_right 360 deg
      radial_acceleration 3 g   
      execute custom_route_completed
end_route

route cap_left
   label start offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
   turn_left 360 deg
      radial_acceleration 3 g
      execute custom_route_completed
end_route

route turn_north_left
   label start offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
   turn_to_heading 0 deg
      turn left
      radial_acceleration 3 g
      execute custom_route_completed
end_route

route turn_north_right
   label start offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
   turn_to_heading 0 deg
      turn right
      radial_acceleration 3 g
      execute custom_route_completed
end_route

route turn_north_shortest
   label start offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
   turn_to_heading 0 deg
      turn shortest
      radial_acceleration 3 g
      execute custom_route_completed
end_route

route turn_south_left
   label start offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
   turn_to_heading 180 deg
      turn left
      radial_acceleration 3 g
      execute custom_route_completed
end_route

route turn_south_right
   label start offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
   turn_to_heading 180 deg
      turn right
      radial_acceleration 3 g
      execute custom_route_completed
end_route


route racetrack_oval
   label wp0 offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
      radial_acceleration 3 g
   
   # 1. E (90°) - Pure East
   label wp1 offset 2.5 0 nm       # 2.5E, 0
      radial_acceleration 3 g
   
   # 2. E (90°) - Another East
   label wp2 offset 2.5 0 nm       # Another 2.5E, 0
      radial_acceleration 3 g
   
   # 3. E (90°) - Third East (doubled distance)
   offset 5.0 0 nm                 # 5.0E, 0
      radial_acceleration 3 g
   
   # 4. NE (45°) - East and North
   offset 2.5 -2.5 nm              # 2.5E, 2.5N (negative Y = North)
      radial_acceleration 3 g
   
   # 5. NW (315°) - West and North
   offset -2.5 -2.5 nm             # 2.5W, 2.5N
      radial_acceleration 3 g
   
   # 6. W (270°) - Pure West
   label wp6 offset -2.5 0 nm      # 2.5W, 0
      radial_acceleration 3 g
   
   # 7. W (270°) - Another West (doubled distance)
   offset -20.0 0 nm                # 5.0W, 0
      radial_acceleration 3 g
   
   # 8. SW (225°) - West and South
   label wp8 offset -2.5 2.5 nm    # 2.5W, 2.5S
      radial_acceleration 3 g
   
   goto wp1
end_route

route racetrack_oval2
   label wp0 offset 0 0 nm
      altitude 30000 feet
      speed 600 nm/h
      radial_acceleration 3 g
   
   # 1. W (270°) - Pure West
   label wp1 offset 2.5 0 nm       # 2.5W, 0
      radial_acceleration 3 g
   
   # 2. W (270°) - Another West
   label wp2 offset 2.5 0 nm       # Another 2.5W, 0
      radial_acceleration 3 g
   
   # 3. W (270°) - Third West
   offset 5.0 0 nm                 # 5.0W, 0
      radial_acceleration 3 g
   
   # 4. SW (225°) - West and South = +X and -Y
   offset 2.5 -2.5 nm              # 2.5W, 2.5S
      radial_acceleration 3 g
   
   # 5. SE (135°) - East and South = -X and -Y (LONGER)
   offset -5.0 -2.5 nm             # 5.0E, 2.5S (long East segment)
      radial_acceleration 3 g
   
   # 6. E (90°) - Pure East = -X only (LONGER)
   label wp6 offset -5.0 0 nm      # 5.0E, 0 (long East)
      radial_acceleration 3 g
   
   # 7. E (90°) - Another East (LONGER)
   offset -16.0 0 nm                # 5.0E, 0 (long East)
      radial_acceleration 3 g
   
   # 8. E (90°) - Third East
   label wp8 offset -2.5 0 nm      # 2.5E, 0
      radial_acceleration 3 g
   
   goto wp1
end_route

# hold at WP0 orbit until racetrack starts
behavior racetrack_leader
   script_variables 
      bool leaderStarted = false;
      bool joinedRacetrack = false;
      WsfPlatform wingman = null;
   end_script_variables
   
   precondition
      if (TIME_NOW > 2 && PLATFORM.AuxDataString("racetrack_role") == "leader")
      {
         return true;
      }
      else
      {
         return false;
      }
   end_precondition
   
   execute
      if (!leaderStarted) {
         leaderStarted = true;
         string wingmanName = PLATFORM.AuxDataString("wingman_name");
         wingman = WsfSimulation.FindPlatform(wingmanName);
         
      }
      
      if (wingman.IsValid() && !joinedRacetrack) {
         double wingmanLon = wingman.Longitude();
         
         if (wingmanLon >= 13.7) {
            joinedRacetrack = true;
            
            WsfRoute racetrack = WsfRoute.FindGlobal("racetrack_oval2");
            if (racetrack.IsValid()) {
               PLATFORM.FollowRoute(racetrack, 0);
            }
         }
      }
      
      PLATFORM.SetAuxData("in_racetrack", joinedRacetrack);
   end_execute
end_behavior

# move straight then join racetrack
behavior racetrack_wingman
   script_variables 
      bool wingmanStarted = false;
      bool joinedRacetrack = false;
      WsfGeoPoint targetLocation = WsfGeoPoint();
   end_script_variables
   
   precondition
      if (TIME_NOW > 2 && PLATFORM.AuxDataString("racetrack_role") == "wingman")
      {
         return true;
      }
      else
      {
         return false;
      }
   end_precondition
   
   execute
      if (!wingmanStarted) {
         wingmanStarted = true;
         
         double currentLat = PLATFORM.Latitude();
         double targetLon = 13.7;
         double targetAlt = PLATFORM.Altitude();
         
         targetLocation = WsfGeoPoint.Construct(currentLat, targetLon, targetAlt);
         PLATFORM.GoToLocation(targetLocation);
      }
      
      double lon = PLATFORM.Longitude();
      
      # check if reached target longitude
      if (!joinedRacetrack && lon >= 13.7) {
         joinedRacetrack = true;
         
         WsfRoute racetrack = WsfRoute.FindGlobal("racetrack_oval");
         if (racetrack.IsValid()) {
            PLATFORM.FollowRoute(racetrack, 0);
         }
      }
      
      PLATFORM.SetAuxData("in_racetrack", joinedRacetrack);
   end_execute
end_behavior
