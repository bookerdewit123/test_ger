# From Model Library
include_once generic_weapon_base.txt

#TO DO: Make the missile as simple as possible (remove seeker), test behavior of the guidance modes
weapon_effects BLUE_SAM_EFFECT WSF_GRADUATED_LETHALITY
   radius_and_pk $<BLUE_RADIUS_PK:100>$ m $<BLUE_WEAPON_PK:0.7>$ # set on assumptions.txt
end_weapon_effects

weapon_effects RED_BOMB_EFFECT WSF_GRADUATED_LETHALITY
   radius_and_pk $<RED_GLIDE_PK_RANGE:100>$ m $<RED_GLIDE_PK:0.7>$ # set on assumptions.txt
end_weapon_effects

platform_type BLUE_SAM GENERIC_SAM
   
   edit mover 
      average_speed $<BLUE_AVERAGE_SPEED_MPS:100>$ kts # set on assumptions.txt
      guide_to_truth true # For similpicity
      guidance_mode lead_pursuit
    end_mover

   edit processor fuse
      max_time_of_flight_to_detonate 200 sec # Should not be limiting factor, range should be, found in assumptions.txt
   end_processor

end_platform_type

weapon BLUE_SAM GENERIC_SAM 
   launched_platform_type BLUE_SAM
   weapon_effects BLUE_SAM_EFFECT
end_weapon

weapon_effects BLUE_AAM_EFFECT WSF_GRADUATED_LETHALITY
   radius_and_pk $<BLUE_RADIUS_PK:100>$ m $<BLUE_WEAPON_PK:0.7>$ # set on assumptions.txt
   
   # This script is called when a weapon detonated but before it applies the hit or miss. This appears to be
   # the only place where we can set a pk degradation and have it be honored.
   script void on_weapon_target_engagement(WsfPlatform aTarget)
      WsfPlatform weaponPlatform = WeaponPlatform();
      if(weaponPlatform.AuxDataExists("CalculatedPK")){
         double calculatedPk = weaponPlatform.AuxDataDouble("CalculatedPK");
      
         double currentPk = Pk();
      
         double pkDegrade = calculatedPk / currentPk; 
   
         # "degrade" the Pk so that it matches the calculated pk
         SetPkDegrade(pkDegrade);
      }      
   end_script
end_weapon_effects

weapon BLUE_AAM GENERIC_SAM 
   launched_platform_type BLUE_SAM
   weapon_effects BLUE_AAM_EFFECT
end_weapon

platform_type RED_GLIDE GENERIC_SAM 
   
   edit mover 
      average_speed $<RED_AVERAGE_SPEED_GLIDE:100>$ m/s //kts # set on assumptions.txt, speed is way faster for video purposes
      guide_to_truth true # For similpicity
      guidance_mode lead_pursuit
    end_mover

   edit processor fuse
      max_time_of_flight_to_detonate 500 sec # Should not be limiting factor, range should be, found in assumptions.txt
   end_processor

end_platform_type

weapon RED_GLIDE GENERIC_SAM 
   launched_platform_type RED_GLIDE
   weapon_effects RED_BOMB_EFFECT
end_weapon