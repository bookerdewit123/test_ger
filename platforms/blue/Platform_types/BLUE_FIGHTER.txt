# File generated by Wizard 2.2205.6 on Oct 13, 2025.
# TO DO: Need accurate sensors (ranges and volumes)
# TO DO: Simple behavior tree needed for CAP, basic pursue (up to CRL), and Scoot (after shoot)
# TO DO: Likely need scripts that take sensor detections and determine if the track is of LOW, MED, or HIGH RCS
platform_type BLUE_FIGHTER G425_PLATFORM_BASE 
spatial_domain air
command_chain FIGHTER_TASKING AEW_C2
position 0n 0w altitude 30000 ft heading 90 deg

################ IMPORTANT ####################
################ NOT REAL VALUES ###############

   mover WSF_AIR_MOVER
      roll_rate_limit               1 rad/sec #temp TODO
      default_linear_acceleration   3.0 g #temp TODO
      default_radial_acceleration   3 g #temp TODO
      default_climb_rate            254 m/s #from wiki
      maximum_climb_rate            260 m/s #extrapolated guess from wiki
      maximum_speed                 1060 knots #janes F15J reference (AT LOW ALTITUDE), probably closer to 2315 knots at high altitude (wiki)
      minimum_speed                 150.0 knots #temp TODO
      maximum_altitude              60000 ft #wiki/janes reference
      minimum_altitude              20000 ft
      maximum_linear_acceleration   3 g #wiki/janes reference
      at_end_of_path extrapolate
      turn_rate_limit               4.0 deg/sec #temp TODO
      maximum_radial_acceleration 6 g
   end_mover
   
### CHANGE
#### TO DO: Need to create script to fire on targets when the C2 task cannot be made. Take into account target type and range
script void SELF_TASKING()
writeln("SELF_TASKING");
end_script


	add router default WSF_COMM_ROUTER
		 use_default_protocol true		 # switch the default router ON
		 automated_interface_linking true	 # router acting as a bridge without inducing any delay
   end_router

comm L16_T 4thGen_Transmit  
   on
   internal_link targeting
   #network_name Topology
#   router_name Comm_Router
end_comm

comm L16_R 4thGen_Receiver  
   on
   #network_name Topology
#   router_name Comm_Router
end_comm


comm MADL_T 5thGen_Transmit
   on
   #network_name Topology
#   router_name Comm_Router
end_comm

comm MADL_R 5thGen_Receiver 
   on
   #network_name Topology
#   router_name Comm_Router
end_comm


   weapon aam BLUE_SAM 
      aux_data 
         #int magazineSize = $<BLUE_FIGHTER_WEAPON_COUNT:-1>$ 
      end_aux_data
      quantity 4 ### This is so that we control when to fire by having it ocurr with reloads
      maximum_request_count 4
   end_weapon
   
   # Fire when tasked by AEW
   # TO DO: Likely need to add logic in here to determine if the task is within range 
   processor  targeting WSF_TASK_PROCESSOR 
   off
      on_message 
         #MIKE CHANGE: Changed from checking WSF_TRACK_MESSAGE to something else
         type SHOOT
         script
         
         if(WsfSimulation.FindPlatform("AEW_C2").IsValid())
         {
            if(PLATFORM.Comm("L16_T").IsConnectedTo(WsfSimulation.FindPlatform("AEW_C2").Comm("L16_R").GetAddress()))
            {
               WsfTrackMessage msg = (WsfTrackMessage)MESSAGE;
               int relative_heading = PLATFORM.RelativeHeadingOf(msg.Track());
               string rel_head = "NO SHOT" + (string)relative_heading;
               if((relative_heading < 110 && relative_heading > 70) || (relative_heading < 20)) #TODO TO DO MIKE: This is to stop missiles from firing when turning
                  {
                  if(PLATFORM.WeaponsActiveFor(msg.Track().TrackId()))
                     return;
                  else
                  {
                     if(PLATFORM.GroundRangeTo(msg.Track()) < 120000)
                     {
                     PLATFORM.Weapon("aam").Fire(msg.Track());
                     PLATFORM.Comment("Released weapon targeting " + msg.Track().TargetName());
                     }
                     }
                  }
                  else
                  {
                     PLATFORM.Comment(rel_head);
                     
                  }
   #            WsfMessage reply = (WsfMessage)MESSAGE;
   #            reply.SetType("REPLY");
   #            PLATFORM.Comm("L16_T").SendMessage(msg, WsfSimulation.FindPlatform("AEW_C2").Name(), "L16_T");
            } 
          }
          else
            PLATFORM.Execute("SELF_TASKING");
         end_script
      end_on_message
   end_processor 
   
   #execute at_time 100 sec absolute
   #   FollowRoute("capRoute");
   #end_execute
   
   processor  task_mgr  WSF_QUANTUM_TASKER_PROCESSOR
      #script_debug_writes  off      
      update_interval 1 sec
      
      behavior_tree
         selector 
           # behavior_node head_to_CRL
           # behavior_node cap
           behavior_node racetrack_cap
         end_selector
      end_behavior_tree
   end_processor
   
   aux_data 
      bool is_in_custom_route = false
      bool out_of_formation = false
      bool evaded = false
   end_aux_data
   script void custom_route_completed()
      SetAuxData("is_in_custom_route", false);
   end_script

#comm L16 TEST_BLUE1
##Need to figure out Networks
#end_comm
#
#comm 5thGen TEST_BLUE2
#end_comm

end_platform_type