# File generated by Wizard 2.2205.6 on Oct 13, 2025.
# TO DO: Need accurate sensors (ranges and volumes)
# TO DO: Simple behavior tree needed for CAP, basic pursue (up to CRL), and Scoot (after shoot)
# TO DO: Likely need scripts that take sensor detections and determine if the track is of LOW, MED, or HIGH RCS
platform_type BLUE_FIGHTER RCS_PLATFORM_BASE 
spatial_domain air
command_chain FIGHTER_TASKING AEW_C2
position 0n 0w altitude 30000 ft heading 90 deg

################ IMPORTANT ####################
################ NOT REAL VALUES ###############

   mover WSF_AIR_MOVER
      roll_rate_limit               1 rad/sec #temp TODO
      default_linear_acceleration   3.0 g #temp TODO
      default_radial_acceleration   3 g #temp TODO
      default_climb_rate            254 m/s #from wiki
      maximum_climb_rate            260 m/s #extrapolated guess from wiki
      maximum_speed                 1060 knots #janes F15J reference (AT LOW ALTITUDE), probably closer to 2315 knots at high altitude (wiki)
      minimum_speed                 150.0 knots #temp TODO
      maximum_altitude              60000 ft #wiki/janes reference
      minimum_altitude              20000 ft
      maximum_linear_acceleration   3 g #wiki/janes reference
      at_end_of_path extrapolate
      turn_rate_limit               4.0 deg/sec #temp TODO
      maximum_radial_acceleration 6 g
   end_mover
   

processor data_mgr WSF_TRACK_PROCESSOR 
   on
#   script bool is_track_reportable(WsfTrack aTrack)
#   // Define the script body here to return a 'true' value if the track should
#   // be reported and 'false' if it should not.
#   //
#   // For example, the following will report the track only if it has been
#   // updated within the last 60 seconds:
#   int test;
#   bool isReportable = true;
#   if (aTrack.TimeSinceUpdated() > WsfRandom.Uniform(0, 3)) isReportable = false;
#   {
#      writeln("MIKE", TIME_NOW);
#      return isReportable;}
#end_script

script void StaggerSendMessage(WsfComm comm, WsfMessage msg, string plat, string commLink)
      if(msg.IsValid())
      {
         if(msg.AuxDataExists("Route") == true)
         {
            if(comm.IsValid())
            {
               comm.SendMessage(msg, plat, commLink);
            }
         }
      }
   end_script
   #report_to platform 5thGen1_Group1 comm MADL_R via MADL_T
end_processor

### CHANGE
#### TO DO: Need to create script to fire on targets when the C2 task cannot be made. Take into account target type and range
script void SELF_TASKING()
writeln("SELF_TASKING");
end_script


	add router default WSF_COMM_ROUTER
		 use_default_protocol true		 # switch the default router ON
		 automated_interface_linking true	 # router acting as a bridge without inducing any delay
   end_router

comm L16_T 4thGen_Transmit  
   on
   internal_link data_mgr
   internal_link targeting
   //network_name Topology
#   router_name Comm_Router
end_comm

comm L16_R 4thGen_Receiver  
   on
   internal_link data_mgr
   //network_name Topology
#   router_name Comm_Router
end_comm


comm MADL_T 5thGen_Transmit
   on
   internal_link data_mgr
   //network_name Topology
#   router_name Comm_Router
end_comm

comm MADL_R 5thGen_Receiver 
   on
   internal_link data_mgr
   //network_name Topology
#   router_name Comm_Router
end_comm


   weapon aam BLUE_SAM 
      aux_data 
         //int magazineSize = $<BLUE_FIGHTER_WEAPON_COUNT:-1>$ 
      end_aux_data
      quantity 4 ### This is so that we control when to fire by having it ocurr with reloads
      maximum_request_count 1
   end_weapon
   
      # Fire when tasked by AEW
      # TO DO: Likely need to add logic in here to determine if the task is within range 
   processor  targeting WSF_TASK_PROCESSOR 
   on
   update_interval 1 s
   internal_link data_mgr
      on_message 
         #MIKE CHANGE: Changed from checking WSF_TRACK_MESSAGE to something else
         type SHOOT
         script
         
         if(WsfSimulation.FindPlatform("AEW_C2").IsValid())
         {
            if(PLATFORM.Comm("L16_T").IsConnectedTo(WsfSimulation.FindPlatform("AEW_C2").Comm("L16_R").GetAddress()))
            {
               WsfTrackMessage msg = (WsfTrackMessage)MESSAGE;
               int relative_heading = PLATFORM.RelativeHeadingOf(msg.Track());
               if(relative_heading < 110 && relative_heading > 70) #TODO TO DO MIKE: This is to stop missiles from firing when turning
                  {
                  if(PLATFORM.WeaponsActiveFor(msg.Track().TrackId()))
                     return;
                  else{
                  PLATFORM.Weapon("aam").Fire(msg.Track());
                  PLATFORM.Comment("Released weapon targeting " + msg.Track().TargetName());}
                  }
                  else
                  {
                     PLATFORM.Comment("NO SHOT");
                     }
   #            WsfMessage reply = (WsfMessage)MESSAGE;
   #            reply.SetType("REPLY");
   #            PLATFORM.Comm("L16_T").SendMessage(msg, WsfSimulation.FindPlatform("AEW_C2").Name(), "L16_T");
            } 
          }
          else
            PLATFORM.Execute("SELF_TASKING");
         end_script
      end_on_message
   end_processor 
   
   #execute at_time 100 sec absolute
   #   FollowRoute("capRoute");
   #end_execute
   
   processor  task_mgr  WSF_QUANTUM_TASKER_PROCESSOR
      //script_debug_writes  off      
      update_interval 1 sec
      
      behavior_tree
         selector 
            behavior_node cap
         end_selector
      end_behavior_tree
   end_processor
   
   aux_data 
      bool is_in_custom_route = false
      bool out_of_formation = false
      bool evaded = false
   end_aux_data
   script void custom_route_completed()
      SetAuxData("is_in_custom_route", false);
   end_script

#comm L16 TEST_BLUE1
#internal_link data_mgr
##Need to figure out Networks
#end_comm
#
#comm 5thGen TEST_BLUE2
#internal_link data_mgr
#end_comm

end_platform_type